<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Pedido | Burger Designers</title>
    <link rel="stylesheet" href="css/cliente.css">
</head>
<body>
    <div class="main-container">
        <div class="div-titulo">
            <h1>Finalizar Pedido</h1>
        </div>

        <form action="cliente.php" method="POST" class="formulario-final" id="form-pedido">
            <div class="seccion-datos">
                <h2>1. Tus Datos</h2>
                <div class="input-group">
                    <label>Nombre</label>
                    <input type="text" name="nombre_cliente" required placeholder="Ej. Luis">
                </div>
                <div class="input-group">
                    <label>Apellido</label>
                    <input type="text" name="apellido_cliente" required placeholder="Ej. Meléndez">
                </div>
                <div class="input-group">
                    <label>Cédula</label>
                    <input type="number" name="cedula_cliente" required>
                </div>
                <div class="input-group">
                    <label>Teléfono</label>
                    <input type="number" name="telefono_cliente" required>
                </div>
            </div>

            <div class="seccion-pago">
                <h2>2. Método de Pago</h2>
                <div class="input-group">
                    <label>¿Cómo deseas pagar?</label>
                    <select name="metodo_pago" id="metodo_pago" onchange="mostrarInstrucciones()" required>
                        <option value="" disabled selected>Selecciona un método</option>
                        <option value="Pago Movil">Pago Móvil</option>
                        <option value="Efectivo">Efectivo</option>
                        <option value="Transferencia">Transferencia</option>
                    </select>
                </div>

                <div id="instrucciones-pago" class="caja-instrucciones" style="display:none;">
                    <p id="texto-datos"></p>
                    <div class="input-group">
                        <label>Referencia (Últimos 4 dígitos)</label>
                        <input type="text" name="referencia" id="referencia" placeholder="0000" maxlength="4">
                    </div>
                </div>

                <div class="resumen-final">
                  <h2 id="total-final">Total a Pagar: <span>$0.00</span></h2>
                </div>

                <input type="hidden" name="monto_total" id="input_monto_oculto">
                <input type="hidden" name="carrito_datos" id="input_carrito_oculto">

                <div class="botones-accion">
                    <button type="submit" class="btn-confirmar">CONFIRMAR COMPRA</button>
                    <a href="pedido.php" class="btn-regresar-premium">
                       <span class="icon">←</span>
                       <span class="text">VOLVER AL MENÚ</span>
                    </a>
                </div>
            </div>
        </form>
    </div>

    <script>
        // Función para mostrar datos de pago según el método seleccionado
        function mostrarInstrucciones() {
            const metodo = document.getElementById('metodo_pago').value;
            const caja = document.getElementById('instrucciones-pago');
            const texto = document.getElementById('texto-datos');
            const inputRef = document.getElementById('referencia');
            
            if (metodo === "Efectivo") {
                caja.style.display = "none";
                inputRef.required = false;
            } else {
                caja.style.display = "block";
                inputRef.required = true;
                if (metodo === "Pago Movil") {
                    texto.innerHTML = "<strong>Pago Móvil:</strong><br>Banesco | 0412-1234567 | V-12.345.678";
                } else if (metodo === "Transferencia") {
                    texto.innerHTML = "<strong>Transferencia:</strong><br>Banesco | 0134-0000-0000-0000 | Burger Designers";
                }
            }
        }

        // Al cargar la página, recuperamos los datos de la "mochila" (LocalStorage)
        document.addEventListener('DOMContentLoaded', () => {
            const montoGuardado = localStorage.getItem('montoFactura'); 
            const productosGuardados = localStorage.getItem('carrito_productos');

            if (montoGuardado && productosGuardados) {
                // 1. Mostramos el total visualmente
                const displayTotal = document.getElementById('total-final');
                if (displayTotal) {
                    displayTotal.innerHTML = `Total a Pagar: <span style="color: #fcc404;">$${montoGuardado}</span>`;
                }
                
                // 2. Llenamos los campos ocultos que irán al PHP
                document.getElementById('input_monto_oculto').value = montoGuardado;
                document.getElementById('input_carrito_oculto').value = productosGuardados;

            } else {
                alert("El carrito está vacío. Regresando al menú...");
                window.location.href = "pedido.php";
            }
        });

        // Verificación final antes de enviar el formulario
        document.getElementById('form-pedido').addEventListener('submit', function(e) {
            const carrito = document.getElementById('input_carrito_oculto').value;
            if (!carrito || carrito === "[]") {
                alert("Error: No hay productos detectados para descontar inventario.");
                e.preventDefault();
            }
        });
    </script>
</body>
</html>